<html>

<head>
    <title>WS Client</title>
</head>

<body>
    <h1>WS Client1</h1>
    <script src="./sock_rpc.js?1"></script>
    <script src="./tlv.js?1"></script>
    <script src="./tlv_types.js?1"></script>
    <script>

      
        const addr = `ws://localhost:8990/ws`
        rpc = new SockRpc({
            addr: addr,
            onMessage: (evt) => {
                console.log('onMessage', evt)
            },
            onError: (evt) => {
                console.log('onError', evt)
            }
        });
        rpc.OnOpen(evt => {
            console.log('onOpen', evt)
            const timestamp = Date.now()
            const auth = '123456'
            const authMsg = {
                auth_token: `auth:${auth}`,
                room_id: 1,
                user_id: 1,
                server_id: 'local',
                action: 0xFE,
                type: "h5",
            }
            console.log('authMsg', authMsg)
            rpc.Send(authMsg)
            setInterval(() => {

                rpc.Call("v1.Test", FrameFromJson({
                    a: 1,
                    b: 2,
                }), data => {
                    console.log('call success', Base64.decode(data))
                })
            }, 2000)
        })
        rpc.Bind('shop', {
            Test: (evt) => {
                console.log('server say hello', arguments)
                return 'helo' + (new Date().getTime())
            }
        })
        rpc.Connect()
    </script>

</body>

</html>